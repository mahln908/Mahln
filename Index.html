<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sabor de Casa - Receitas Deliciosas</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        *{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif}
        :root{
            --primary-color:#FFA366; /* Laranja mais claro */
            --secondary-color:#7B3F00;
            --accent-color:#FFE66D;
            --dark-color:#292F36;
            --light-color:#FFF9F0;
            --card-bg:#ffffff;
            --text-color:#333333;
            --border-radius:12px;
            --shadow:0 8px 20px rgba(0,0,0,0.1);
            --transition:all 0.3s ease;
        }
        body{background-color:var(--light-color);color:var(--text-color);line-height:1.6}
        
        /* Header com altura reduzida e cor mais clara */
        header{
            background: linear-gradient(135deg, var(--primary-color), #FF8C42);
            color:white;
            padding:0.4rem 1rem;
            text-align:center;
            box-shadow:0 4px 12px rgba(0,0,0,0.15);
            position:sticky;
            top:0;
            z-index:100;
        }
        .logo-container{
            display:flex;
            justify-content:center;
            align-items:center;
            margin-bottom:0.2rem;
        }
        .logo-text{
            background:rgba(255,255,255,0.25);
            padding:6px 14px;
            border-radius:50px;
            backdrop-filter:blur(8px);
            display:flex;
            align-items:center;
            justify-content:center;
            box-shadow:0 4px 10px rgba(0,0,0,0.1);
        }
        .pan-icon{
            font-size:1.6rem;
            color:var(--accent-color);
            margin-right:10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            animation: cook 4s infinite;
        }
        @keyframes cook {
            0% { transform: rotate(0deg) scale(1); }
            25% { transform: rotate(5deg) scale(1.05); }
            50% { transform: rotate(0deg) scale(1); }
            75% { transform: rotate(-5deg) scale(1.05); }
           100% { transform: rotate(0deg) scale(1); }
        }
        h1{
            font-size:1.6rem;
            margin:0;
            text-shadow:2px 2px 6px rgba(0,0,0,0.3);
            display:inline;
            font-weight:800;
            letter-spacing:0.5px;
        }
        .tagline{
            font-style:italic;
            margin-bottom:0.4rem;
            font-size:0.8rem;
            opacity:0.9;
        }
        .search-container{
            margin:0.5rem auto;
            max-width:450px;
            position:relative;
        }
        .search-input{
            width:100%;
            padding:8px 16px;
            border:none;
            border-radius:50px;
            font-size:0.9rem;
            box-shadow:var(--shadow);
            transition:var(--transition);
        }
        .search-input:focus{
            outline:none;
            box-shadow:0 5px 15px rgba(0,0,0,0.2);
            transform:translateY(-2px);
        }
        .search-btn{
            position:absolute;
            right:5px;
            top:5px;
            background:var(--secondary-color);
            border:none;
            color:white;
            padding:5px 12px;
            border-radius:50px;
            cursor:pointer;
            font-size:0.9rem;
            transition:var(--transition);
        }
        .search-btn:hover{
            background:#5a2e00;
            transform:scale(1.05);
        }
        
        /* Categorias com altura reduzida */
        .categories{
            display:flex;
            overflow-x:auto;
            gap:6px;
            padding:0.6rem;
            margin:0.4rem 0;
            scrollbar-width:thin;
            -ms-overflow-style:none;
        }
        .categories::-webkit-scrollbar{height:6px}
        .categories::-webkit-scrollbar-thumb{
            background:var(--primary-color);
            border-radius:10px;
        }
        .category-btn{
            background:rgba(255,255,255,0.9);
            border:none;
            padding:5px 10px;
            border-radius:50px;
            cursor:pointer;
            font-weight:600;
            white-space:nowrap;
            transition:var(--transition);
            box-shadow:0 3px 8px rgba(0,0,0,0.1);
            font-size:0.8rem;
            border:2px solid transparent;
        }
        .category-btn:hover{
            background:var(--accent-color);
            transform:translateY(-3px);
            box-shadow:0 5px 12px rgba(0,0,0,0.15);
            color:var(--dark-color);
        }
        .category-btn.active{
            background:var(--secondary-color);
            color:white;
            border-color:var(--accent-color);
        }
        
        /* Container e grid */
        .container{
            max-width:1280px;
            margin:0 auto;
            padding:1.5rem;
        }
        .recipe-grid{
            display:grid;
            grid-template-columns:repeat(auto-fill,minmax(280px,1fr));
            gap:1.8rem;
            margin-top:1.5rem;
        }
        .recipe-card{
            background:var(--card-bg);
            border-radius:var(--border-radius);
            overflow:hidden;
            box-shadow:var(--shadow);
            transition:var(--transition);
            cursor:pointer;
            height:320px;
            display:flex;
            flex-direction:column;
        }
        .recipe-card:hover{
            transform:translateY(-8px);
            box-shadow:0 15px 25px rgba(0,0,0,0.2);
        }
        .recipe-image{
            width:100%;
            height:200px;
            object-fit:cover;
            transition:var(--transition);
        }
        .recipe-card:hover .recipe-image{
            transform:scale(1.05);
        }
        .recipe-content{
            padding:1rem;
            display:flex;
            flex-direction:column;
            justify-content:space-between;
            flex-grow:1;
        }
        .recipe-title{
            font-size:1.1rem;
            margin-bottom:0.6rem;
            color:var(--dark-color);
            font-weight:700;
            display:-webkit-box;
            -webkit-line-clamp:2;
            -webkit-box-orient:vertical;
            overflow:hidden;
        }
        .recipe-meta{
            display:flex;
            justify-content:space-between;
            align-items:center;
        }
        .recipe-category{
            background:var(--secondary-color);
            color:white;
            padding:4px 10px;
            border-radius:20px;
            font-size:0.75rem;
            font-weight:600;
        }
        .recipe-time{
            display:flex;
            align-items:center;
            color:#666;
            font-size:0.85rem;
            font-weight:500;
        }
        .recipe-time i{
            margin-right:6px;
            color:var(--primary-color);
            font-size:0.9rem;
        }
        
        /* Espaço para anúncios */
        .ad-space{
            grid-column:1/-1;
            background:linear-gradient(to right, #f9f9f9, #f0f0f0);
            border-radius:var(--border-radius);
            padding:1.5rem;
            text-align:center;
            margin:1.5rem 0;
            height:180px;
            display:flex;
            flex-direction:column;
            justify-content:center;
            align-items:center;
            border:2px dashed #ddd;
            transition:var(--transition);
        }
        .ad-space:hover{
            border-color:var(--primary-color);
            background:linear-gradient(to right, #f5f5f5, #eaeaea);
        }
        .ad-space i{
            font-size:2.5rem;
            color:#ccc;
            margin-bottom:0.8rem;
        }
        .ad-space p{
            color:#888;
            font-size:1rem;
        }
        
        /* Footer */
        footer{
            background:var(--dark-color);
            color:white;
            text-align:center;
            padding:2rem;
            margin-top:3rem;
            font-size:0.9rem;
        }
        footer p:first-child {
            margin-bottom: 0.5rem;
        }
        
        /* Loading */
        .loading{
            text-align:center;
            padding:2rem;
            font-size:1.1rem;
            color:var(--secondary-color);
        }
        .loading i{
            animation:spin 1s infinite linear;
            margin-right:10px;
            color:var(--primary-color);
            font-size:1.3rem;
        }
        @keyframes spin{
            0%{transform:rotate(0deg)}
           100%{transform:rotate(360deg)}
        }
        
        /* Responsividade */
        @media (max-width:768px){
            .recipe-grid{grid-template-columns:repeat(auto-fill,minmax(250px,1fr))}
            h1{font-size:1.4rem}
            .pan-icon{font-size:1.4rem;margin-right:8px}
        }
        @media (max-width:480px){
            .recipe-grid{grid-template-columns:1fr}
            h1{font-size:1.2rem}
            .logo-text{flex-direction:row}
            .pan-icon{margin-right:6px; font-size: 1.2rem;}
        }
    </style>
</head>
<body>
    <header id="main-header">
        <div class="logo-container">
            <div class="logo-text">
                <div class="pan-icon"><i class="fas fa-pot-food"></i></div>
                <h1>Sabor de Casa</h1>
            </div>
        </div>
        <p class="tagline">Receitas deliciosas para o seu dia a dia</p>
        <div class="search-container">
            <input type="text" class="search-input" id="search-input" placeholder="Buscar receitas...">
            <button class="search-btn" id="search-btn"><i class="fas fa-search"></i></button>
        </div>
        <div class="categories" id="categories-container">
            <button class="category-btn active" data-category="all">Todas</button>
            <!-- As categorias serão preenchidas dinamicamente -->
        </div>
    </header>

    <div class="container">
        <div class="loading" id="loading"><i class="fas fa-spinner"></i> Carregando receitas...</div>
        <div class="recipe-grid" id="recipe-grid"></div>
    </div>

    <footer>
        <p>&copy; 2023 Sabor de Casa - Todos os direitos reservados</p>
        <p>Desenvolvido com <i class="fas fa-heart" style="color: var(--primary-color);"></i> para amantes da culinária</p>
    </footer>

    <script>
        // API key e ID da planilha
        const API_KEY = 'AIzaSyBqhpdzVXugN1GgkRUUHJ4Yo5JvjvY_wBc';
        const SPREADSHEET_ID = '14dMXRPrTP6SCldqhprh2wulLtZJZSL3XQpawWISATVc';
        const RANGE = 'A:F';

        // Elementos do DOM
        const recipeGrid = document.getElementById('recipe-grid');
        const loadingElement = document.getElementById('loading');
        const categoriesContainer = document.getElementById('categories-container');
        const searchInput = document.getElementById('search-input');
        const searchBtn = document.getElementById('search-btn');

        // Variáveis para armazenar as receitas
        let recipes = [];
        let filteredRecipes = [];
        let categories = new Set(["all"]);

        // Categorias solicitadas
        const defaultCategories = [
            "Pratos Principais", "Massas", "Bolos", "Low Carb", 
            "Peixes", "Sobremesas", "Sucos", "Pães"
        ];

        // Função para converter link do Google Drive em link direto para imagem
        function convertGoogleDriveLink(url) {
            if (!url) return null;
            
            // Se já for um link direto de imagem, retorna como está
            if (url.match(/\.(jpeg|jpg|gif|png|webp|svg)(\?.*)?$/i)) return url;
            
            // Se for um link do Google Drive, converte para link direto
            if (url.includes('drive.google.com')) {
                const match = url.match(/\/d\/([^\/]+)/);
                if (match && match[1]) {
                    return `https://drive.google.com/uc?export=view&id=${match[1]}`;
                }
            }
            
            return url;
        }

        // Função para atualizar as categorias na interface
        function updateCategories() {
            const allButton = categoriesContainer.querySelector('[data-category="all"]');
            categoriesContainer.innerHTML = '';
            categoriesContainer.appendChild(allButton);
            
            // Adicionar categorias da planilha
            categories.forEach(category => {
                if (category !== "all" && category) {
                    const button = document.createElement('button');
                    button.className = 'category-btn';
                    button.setAttribute('data-category', category);
                    button.textContent = category;
                    categoriesContainer.appendChild(button);
                }
            });
            
            // Adicionar categorias padrão que não estão na planilha
            defaultCategories.forEach(category => {
                if (!categories.has(category)) {
                    const button = document.createElement('button');
                    button.className = 'category-btn';
                    button.setAttribute('data-category', category);
                    button.textContent = category;
                    categoriesContainer.appendChild(button);
                }
            });
            
            addCategoryEventListeners();
        }

        // Função para adicionar event listeners aos botões de categoria
        function addCategoryEventListeners() {
            const categoryButtons = categoriesContainer.querySelectorAll('.category-btn');
            categoryButtons.forEach(button => {
                button.addEventListener('click', () => {
                    categoryButtons.forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    filterRecipesByCategory(button.getAttribute('data-category'));
                });
            });
        }

        // Função para buscar dados da planilha
        async function fetchSheetData() {
            try {
                loadingElement.style.display = 'block';
                const url = `https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/${RANGE}?key=${API_KEY}`;
                const response = await fetch(url);
                const data = await response.json();
                
                if (data && data.values && data.values.length > 1) {
                    const headers = data.values[0].map(header => header.toLowerCase().replace(/\s+/g, ''));
                    const rows = data.values.slice(1);
                    
                    categories.clear();
                    categories.add("all");
                    
                    recipes = rows.map(row => {
                        const recipe = {};
                        headers.forEach((header, index) => {
                            recipe[header] = row[index] || '';
                        });
                        
                        // Processar URL da imagem (converter link do Google Drive se necessário)
                        if (recipe.url) {
                            recipe.processedUrl = convertGoogleDriveLink(recipe.url);
                        }
                        
                        // Adicionar categoria ao conjunto de categorias
                        if (recipe.categoria && recipe.categoria.trim() !== '') {
                            categories.add(recipe.categoria.trim());
                        }
                        
                        return recipe;
                    });
                    
                    updateCategories();
                    filteredRecipes = recipes;
                    displayRecipes(filteredRecipes);
                } else {
                    throw new Error('Dados não encontrados na planilha');
                }
            } catch (error) {
                console.error('Erro ao buscar dados:', error);
                recipeGrid.innerHTML = `<div class="error">Erro ao carregar receitas: ${error.message}. Verifique se a planilha está pública.</div>`;
                
                // Carregar categorias padrão em case de erro
                updateCategories();
            } finally {
                loadingElement.style.display = 'none';
            }
        }

        // Função para exibir as receitas
        function displayRecipes(recipesToDisplay) {
            recipeGrid.innerHTML = '';
            if (recipesToDisplay.length === 0) {
                recipeGrid.innerHTML = '<p class="no-results">Nenhuma receita encontrada.</p>';
                return;
            }
            
            recipesToDisplay.forEach((recipe, index) => {
                if (index > 0 && index % 2 === 0) {
                    const adSpace = document.createElement('div');
                    adSpace.className = 'ad-space';
                    adSpace.innerHTML = `<i class="fas fa-ad"></i><p>Espaço para publicidade</p>`;
                    recipeGrid.appendChild(adSpace);
                }
                
                const recipeCard = document.createElement('div');
                recipeCard.className = 'recipe-card';
                
                // Gerar um ID único para a receita
                const recipeId = 'recipe-' + index + '-' + recipe.nome.toLowerCase().replace(/\s+/g, '-');
                
                // Adicionar evento de clique que redireciona para página separada
                recipeCard.addEventListener('click', () => {
                    // Salvar a receita no localStorage
                    localStorage.setItem('currentRecipe', JSON.stringify(recipe));
                    // Redirecionar para a página da receita
                    window.location.href = 'receita.html?id=' + recipeId;
                });
                
                const imageUrl = recipe.processedUrl || recipe.url || 'https://images.unsplash.com/photo-1556909114-f6e7ad7d3136?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=600&q=80';
                
                recipeCard.innerHTML = `
                    <img src="${imageUrl}" alt="${recipe.nome}" class="recipe-image" onerror="this.src='https://images.unsplash.com/photo-1556909114-f6e7ad7d3136?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=600&q=80'">
                    <div class="recipe-content">
                        <h3 class="recipe-title">${recipe.nome}</h3>
                        <div class="recipe-meta">
                            <span class="recipe-category">${recipe.categoria}</span>
                            <span class="recipe-time"><i class="fas fa-clock"></i> ${recipe.tempo}</span>
                        </div>
                    </div>
                `;
                
                recipeGrid.appendChild(recipeCard);
            });
        }

        // Função para filtrar receitas por categoria
        function filterRecipesByCategory(category) {
            if (category === 'all') {
                filteredRecipes = recipes;
            } else {
                filteredRecipes = recipes.filter(recipe => 
                    recipe.categoria && recipe.categoria.toLowerCase() === category.toLowerCase()
                );
            }
            displayRecipes(filteredRecipes);
        }

        // Função para pesquisar receitas
        function searchRecipes() {
            const searchTerm = searchInput.value.toLowerCase().trim();
            
            if (searchTerm === '') {
                // Se a pesquisa estiver vazia, mostrar receitas filtradas pela categoria atual
                const activeCategory = document.querySelector('.category-btn.active').getAttribute('data-category');
                filterRecipesByCategory(activeCategory);
                return;
            }
            
            // Filtrar por termo de pesquisa independentemente da categoria
            const searchResults = recipes.filter(recipe => 
                recipe.nome && recipe.nome.toLowerCase().includes(searchTerm) ||
                (recipe.ingrediente && recipe.ingrediente.toLowerCase().includes(searchTerm)) ||
                (recipe.categoria && recipe.categoria.toLowerCase().includes(searchTerm))
            );
            
            displayRecipes(searchResults);
        }

        // Event listeners
        searchBtn.addEventListener('click', searchRecipes);
        searchInput.addEventListener('keyup', (e) => { 
            if (e.key === 'Enter') searchRecipes(); 
        });
        
        searchInput.addEventListener('input', () => {
            if (searchInput.value === '') {
                const activeCategory = document.querySelector('.category-btn.active').getAttribute('data-category');
                filterRecipesByCategory(activeCategory);
            }
        });

        // Inicializar a busca de dados quando a página carregar
        document.addEventListener('DOMContentLoaded', fetchSheetData);
    </script>
</body>
</html>
